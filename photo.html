<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dance Posture Recognition - 照片模式</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Photo Mode</h1>
            <h2>照片模式 - 多姿勢練習</h2>
            <div class="mode-navigation">
                <button id="backToVideoMode" class="btn-secondary">← 回影片模式</button>
            </div>
        </header>

        <main>
            <!-- Photo Upload Section -->
            <section class="upload-section">
                <h3>第一步：上載 5 張姿勢照片</h3>
                <p>上載 5 張唔同嘅跳舞姿勢照片，系統會自動檢測每個姿勢</p>
                <div class="photo-upload-area">
                    <input type="file" id="photoInput" accept="image/*" multiple>
                    <label for="photoInput" class="upload-label">
                        <div class="upload-icon">📸</div>
                        <span>選擇 5 張照片</span>
                        <small>可以選擇多張檔案</small>
                    </label>
                </div>

                <!-- Processing Progress -->
                <div class="processing-progress" id="processingProgress" style="display: none;">
                    <h4>處理照片中...</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="photoProgressFill"></div>
                    </div>
                    <div class="progress-text" id="photoProgressText">準備中...</div>
                </div>

                <!-- Photo Preview Grid -->
                <div class="photo-preview-grid" id="photoPreviewGrid" style="display: none;">
                    <h4>已上載嘅照片 <span id="photoCount">(0/5)</span></h4>
                    <div class="photo-grid" id="photoGrid">
                        <!-- 5 photo slots will be generated here -->
                    </div>
                    <div class="photo-instructions">
                        <p>💡 <strong>提示：</strong>點擊照片可以放大查看細節</p>
                    </div>
                </div>
            </section>

            <!-- Pose Selection Section -->
            <section class="pose-selection-section" id="poseSelectionSection" style="display: none;">
                <h3>第二步：選擇要練習嘅姿勢</h3>
                <p>系統已經檢測到以下姿勢，選擇你想練習嘅項目</p>

                <div class="detected-poses-grid" id="detectedPosesGrid">
                    <!-- Detected poses will be shown here -->
                </div>

                <div class="selection-controls">
                    <button id="selectAllPoses" class="btn-small">全選</button>
                    <button id="deselectAllPoses" class="btn-small">全唔選</button>
                    <button id="startPracticeBtn" class="btn-primary" disabled>開始練習</button>
                </div>
            </section>

            <!-- Practice Section -->
            <section class="practice-section" id="practiceSection" style="display: none;">
                <h3>第三步：跟住練習</h3>
                <p>跟住左邊嘅目標姿勢練習</p>

                <div class="practice-info">
                    <div class="current-pose-info">
                        <div class="pose-info-inline">
                            <span class="pose-label">目前姿勢: <span id="currentPoseLabel">姿勢1</span></span>
                            <span class="pose-progress">進度: <span id="currentPoseIndex">1</span> / <span id="totalPoses">5</span></span>
                            <div class="inline-score-display">
                                <div class="current-score-inline">
                                    <div class="pose-score-circle" id="practiceScoreCircle">
                                        <span class="pose-score-text" id="practiceScoreText">--</span>
                                    </div>
                                    <div class="pose-score-feedback" id="practiceFeedback">未檢測到</div>
                                </div>
                                <div class="overall-feedback" id="practiceOverallFeedback">跟住做！</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pose Transition Animation (in user camera area) -->
                <div class="pose-transition-inline" id="poseTransition" style="display: none;">
                    <div class="transition-overlay-inline">
                        <div class="transition-content-inline">
                            <div class="countdown-number" id="countdownNumber">2</div>
                            <div class="transition-text">準備切換姿勢...</div>
                        </div>
                    </div>
                </div>


                <!-- Unified Control Panel -->
                <div class="unified-controls" id="unifiedControls">
                    <div class="all-controls-inline">
                        <button id="startCameraBtn" class="btn-primary">啟動相機</button>
                        <button id="stopCameraBtn" class="btn-secondary" disabled>停止相機</button>
                        <button id="prevPoseBtn" class="btn-small" disabled>上一個姿勢</button>
                        <button id="nextPoseBtn" class="btn-small" disabled>下一個姿勢</button>
                        <button id="restartPracticeBtn" class="btn-secondary" style="display: none;">🔄 重新練習</button>
                        <button id="finishPracticeBtn" class="btn-secondary">✅ 結束練習</button>
                    </div>
                </div>

                <div class="dual-video-container">
                    <!-- Target Pose Side -->
                    <div class="video-panel">
                        <h4 id="targetPoseTitle">目標姿勢</h4>
                        <div class="video-wrapper">
                            <canvas id="targetPoseCanvas" width="400" height="300"></canvas>
                        </div>
                        <div class="pose-name-display" id="poseNameDisplay">等待選擇姿勢...</div>
                    </div>

                    <!-- User Camera Side -->
                    <div class="video-panel">
                        <h4>你嘅表現</h4>
                        <div class="video-wrapper">
                            <video id="userVideo" autoplay playsinline></video>
                            <canvas id="userPoseCanvas"></canvas>
                            <!-- Pose Transition Animation (in user camera area) -->
                            <div class="pose-transition-inline" id="poseTransition" style="display: none;">
                                <div class="transition-overlay-inline">
                                    <div class="transition-content-inline">
                                        <div class="countdown-number" id="countdownNumber">2</div>
                                        <div class="transition-text">準備切換姿勢...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="video-controls">
                            <button id="mirrorToggle" class="btn-small">鏡像視圖</button>
                        </div>
                    </div>
                </div>


            </section>

            <!-- Overall Scores Summary (shown at the end) -->
            <section class="score-section" id="scoreSectionFull" style="display: none;">
                <h3>即時姿勢分數</h3>
                <div class="score-display">
                    <div class="current-score" id="currentScoreDisplay">
                        <div class="pose-score-circle" id="currentScoreCircleFull">
                            <span class="pose-score-text" id="currentScoreTextFull">--</span>
                        </div>
                        <div class="pose-score-feedback" id="currentFeedbackFull">未檢測到</div>
                    </div>

                    <div class="overall-feedback" id="overallFeedbackFull">上載照片開始練習</div>
                </div>

                <!-- Overall Scores Summary (shown at the end) -->
                <div class="overall-scores" id="overallScores" style="display: none;">
                    <h4>練習總結</h4>
                    <div class="scores-grid" id="scoresGrid">
                        <!-- Individual pose scores will be shown here -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Photo Modal -->
        <div class="photo-modal" id="photoModal" style="display: none;">
            <div class="modal-backdrop" id="modalBackdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">照片預覽</h3>
                    <button class="modal-close" id="modalClose">×</button>
                </div>
                <div class="modal-body">
                    <img id="modalImage" src="" alt="Photo Preview">
                    <div class="modal-info">
                        <p id="modalInfo">點擊照片可以查看細節</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">上載照片開始</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="js/photo_app.js"></script>
</body>
</html>
